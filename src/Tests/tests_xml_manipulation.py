# user defined
from src.Parse_xml import parse_xml

# 3rd party
from lxml import etree

# built-in
import unittest


class TestXmlManipulation(unittest.TestCase):
    def test_merge(self):
        original_xml = '<?xml version="1.0" encoding="UTF-8" standalone="yes"?><Entities TotalResults="995"><Entity Type="defect"><Fields><Field Name="user-template-08"><Value>ipalomar</Value></Field><Field Name="user-template-07"><Value></Value></Field><Field Name="user-template-09"><Value>arturo_domingo</Value></Field><Field Name="name"><Value>Print Care Maintenance alerts (PMK alerts) are not displaying the same information on Printcare and Sonar UI Web</Value></Field></Fields><RelatedEntities/></Entity><Entity Type="defect"><Fields><Field Name="user-102"><Value></Value></Field><Field Name="user-100"><Value></Value></Field></Fields><RelatedEntities/></Entity></Entities>'
        second_xml = '<?xml version="1.0" encoding="UTF-8" standalone="yes"?><Entities TotalResults="995"><Entity Type="defect"><Fields><Field Name="user-84"><Value></Value></Field><Field Name="name"><Value>Printer maintenance status is not the same in Sonar and PrintCare (and Service Center)</Value></Field><Field Name="has-linkage"><Value>N</Value></Field></Fields><RelatedEntities/></Entity><Entity Type="defect"><Fields><Field Name="user-template-08"><Value>01</Value></Field><Field Name="user-template-07"><Value></Value></Field></Fields><RelatedEntities/></Entity></Entities>'
        result = parse_xml.merge(original_xml=original_xml, second_xml=second_xml)  # type str

        # i need to creat an xml tree to query using XPath to test that everything is as expected
        root = etree.fromstring(result.encode('utf-8'))

        self.assertEqual("defect", root.xpath("Entity[1]")[0].get("Type"))
        self.assertEqual("user-template-08", root.xpath("Entity[1]/Fields/Field[1]")[0].get("Name"))
        self.assertEqual("ipalomar", root.xpath("Entity[1]/Fields/Field[1]/Value")[0].text)
        self.assertEqual("user-template-07", root.xpath("Entity[1]/Fields/Field[2]")[0].get("Name"))
        self.assertEqual(None, root.xpath("Entity[1]/Fields/Field[2]/Value")[0].text)
        self.assertEqual("user-template-09", root.xpath("Entity[1]/Fields/Field[3]")[0].get("Name"))
        self.assertEqual("arturo_domingo", root.xpath("Entity[1]/Fields/Field[3]/Value")[0].text)
        self.assertEqual("name", root.xpath("Entity[1]/Fields/Field[4]")[0].get("Name"))
        self.assertEqual("Print Care Maintenance alerts (PMK alerts) are not displaying the same information on Printcare and Sonar UI Web", root.xpath("Entity[1]/Fields/Field[4]/Value")[0].text)

        self.assertEqual("user-102", root.xpath("Entity[2]/Fields/Field[1]")[0].get("Name"))
        self.assertEqual(None, root.xpath("Entity[2]/Fields/Field[1]/Value")[0].text)
        self.assertEqual("user-100", root.xpath("Entity[2]/Fields/Field[2]")[0].get("Name"))
        self.assertEqual(None, root.xpath("Entity[2]/Fields/Field[2]/Value")[0].text)

        self.assertEqual("user-84", root.xpath("Entity[3]/Fields/Field[1]")[0].get("Name"))
        self.assertEqual(None, root.xpath("Entity[3]/Fields/Field[1]/Value")[0].text)
        self.assertEqual("name", root.xpath("Entity[3]/Fields/Field[2]")[0].get("Name"))
        self.assertEqual("Printer maintenance status is not the same in Sonar and PrintCare (and Service Center)" , root.xpath("Entity[3]/Fields/Field[2]/Value")[0].text)
        self.assertEqual("has-linkage", root.xpath("Entity[3]/Fields/Field[3]")[0].get("Name"))
        self.assertEqual("N", root.xpath("Entity[3]/Fields/Field[3]/Value")[0].text)

        self.assertEqual("user-template-08", root.xpath("Entity[4]/Fields/Field[1]")[0].get("Name"))
        self.assertEqual("01", root.xpath("Entity[4]/Fields/Field[1]/Value")[0].text)
        self.assertEqual("user-template-07", root.xpath("Entity[4]/Fields/Field[2]")[0].get("Name"))
        self.assertEqual(None, root.xpath("Entity[4]/Fields/Field[2]/Value")[0].text)

    def test_merge2(self):
        original_xml = '<?xml version="1.0" encoding="UTF-8" standalone="yes"?><Entities TotalResults="995"><Entity Type="defect"><Fields><Field Name="user-template-08"><Value>ipalomar</Value></Field><Field Name="user-template-07"><Value></Value></Field><Field Name="user-template-09"><Value>arturo_domingo</Value></Field><Field Name="has-change"><Value></Value></Field><Field Name="user-template-02"><Value></Value></Field><Field Name="priority"><Value></Value></Field><Field Name="user-39"><Value>3 - Medium</Value></Field><Field Name="status"><Value>Closed</Value></Field><Field Name="closing-date"><Value>2018-10-01</Value></Field><Field Name="user-31"><Value></Value></Field><Field Name="user-32"><Value></Value></Field><Field Name="user-33"><Value></Value></Field><Field Name="user-34"><Value>PrintOS</Value></Field><Field Name="user-35"><Value>Reject</Value></Field><Field Name="user-36"><Value></Value></Field><Field Name="user-37"><Value></Value></Field><Field Name="user-38"><Value></Value></Field><Field Name="estimated-fix-time"/><Field Name="user-41"><Value></Value></Field><Field Name="user-40"><Value></Value></Field><Field Name="owner"><Value>ipalomar_hp.com</Value></Field><Field Name="actual-fix-time"><Value>0</Value></Field><Field Name="test-reference"/><Field Name="user-47"><Value></Value></Field><Field Name="request-server"><Value></Value></Field><Field Name="user-44"><Value></Value></Field><Field Name="user-45"><Value></Value></Field><Field Name="user-42"><Value>None</Value></Field><Field Name="user-43"><Value>6</Value></Field><Field Name="user-52"><Value>3D-Tatooine</Value></Field><Field Name="id"><Value>110731</Value></Field><Field Name="user-51"><Value></Value></Field><Field Name="user-50"><Value></Value></Field><Field Name="name"><Value>[PrintOS] When the Heartbeat is rejected at GDS, Command Center is not notified</Value></Field><Field Name="has-linkage"><Value>N</Value></Field><Field Name="cycle-reference"><Value></Value></Field><Field Name="closing-version"><Value></Value></Field><Field Name="request-note"><Value></Value></Field><Field Name="user-57"><Value>None</Value></Field><Field Name="detected-in-rcyc"><Value></Value></Field><Field Name="user-58"><Value></Value></Field><Field Name="severity"><Value>3 - Medium</Value></Field><Field Name="user-59"><Value></Value></Field><Field Name="attachment"><Value>Y</Value></Field><Field Name="user-53"><Value></Value></Field><Field Name="user-54"><Value>Implementation</Value></Field><Field Name="user-55"><Value></Value></Field><Field Name="user-56"><Value>3 - Medium</Value></Field><Field Name="name"><Value>Print Care Maintenance alerts (PMK alerts) are not displaying the same information on Printcare and Sonar UI Web</Value></Field><Field Name="has-linkage"><Value>N</Value></Field></Fields><RelatedEntities/></Entity><Entity Type="defect"><Fields><Field Name="user-template-08"><Value>01</Value></Field><Field Name="user-template-07"><Value></Value></Field><Field Name="user-template-09"><Value>01</Value></Field><Field Name="has-change"><Value></Value></Field><Field Name="user-template-02"><Value></Value></Field><Field Name="user-template-01"><Value>TEAM01</Value><Value>HP</Value></Field><Field Name="user-template-04"><Value>ALMCR78B125613</Value></Field><Field Name="user-template-03"><Value>0</Value></Field><Field Name="user-template-06"><Value>Validated</Value></Field><Field Name="user-template-05"><Value></Value></Field><Field Name="has-others-linkage"><Value>N</Value></Field><Field Name="run-reference"/><Field Name="to-mail"><Value></Value></Field><Field Name="cycle-id"/><Field Name="user-90"><Value>PrintOS</Value></Field><Field Name="user-91"><Value></Value></Field><Field Name="user-92"><Value></Value></Field><Field Name="user-93"><Value></Value></Field><Field Name="user-94"/><Field Name="user-95"><Value></Value></Field><Field Name="user-96"><Value></Value></Field><Field Name="detected-in-rel"><Value></Value></Field><Field Name="user-103"><Value></Value></Field><Field Name="user-104"><Value></Value></Field><Field Name="user-101"><Value></Value></Field><Field Name="user-102"><Value></Value></Field><Field Name="user-100"><Value></Value></Field><Field Name="target-rel"><Value></Value></Field><Field Name="project"><Value>NPD-New Products</Value></Field><Field Name="step-reference"/><Field Name="user-87"><Value></Value></Field><Field Name="user-86"><Value></Value></Field><Field Name="user-89"><Value></Value></Field><Field Name="user-88"><Value></Value></Field><Field Name="request-type"><Value></Value></Field><Field Name="user-05"><Value>Closed</Value></Field><Field Name="user-84"><Value></Value></Field><Field Name="user-04"><Value></Value></Field><Field Name="user-85"><Value>Test: Exploratory</Value></Field><Field Name="user-03"><Value></Value></Field><Field Name="user-82"><Value>Z600 Workstation, Windows 10x64</Value></Field><Field Name="user-02"><Value></Value></Field><Field Name="user-83"><Value></Value></Field><Field Name="user-01"><Value></Value></Field><Field Name="user-80"><Value>Production</Value></Field><Field Name="user-81"><Value>Mozilla Firefox</Value></Field><Field Name="subject"/><Field Name="request-id"/><Field Name="user-09"><Value></Value></Field><Field Name="user-08"><Value></Value></Field><Field Name="user-07"><Value>ServiceCenter;#153312664</Value></Field><Field Name="user-06"><Value></Value></Field><Field Name="user-79"/><Field Name="creation-time"><Value>2017-11-28</Value></Field><Field Name="user-78"/><Field Name="user-77"/><Field Name="user-76"/><Field Name="user-75"><Value>Test Executor</Value></Field><Field Name="user-14"><Value>2018-01-02 07:37:24</Value></Field><Field Name="detection-version"><Value></Value></Field><Field Name="user-71"><Value></Value></Field><Field Name="user-13"><Value></Value></Field><Field Name="user-72"><Value></Value></Field><Field Name="user-16"><Value>2018-01-08 11:45:43</Value></Field><Field Name="user-73"><Value></Value></Field><Field Name="user-15"><Value></Value></Field><Field Name="user-74"><Value></Value></Field><Field Name="user-10"><Value></Value></Field><Field Name="last-modified"><Value>2018-11-16 07:28:05</Value></Field><Field Name="user-12"><Value></Value></Field><Field Name="user-11"><Value></Value></Field><Field Name="user-70"><Value></Value></Field><Field Name="user-template-16"><Value></Value></Field><Field Name="user-template-15"><Value></Value></Field><Field Name="user-template-14"><Value>2018-01-02</Value></Field><Field Name="user-template-13"/><Field Name="user-18"><Value></Value></Field><Field Name="user-template-12"><Value></Value></Field><Field Name="user-17"><Value></Value></Field><Field Name="user-template-11"><Value>Resolution Approved</Value></Field><Field Name="user-template-10"><Value></Value></Field><Field Name="user-19"><Value>2017-11-28</Value></Field><Field Name="extended-reference"><Value></Value></Field><Field Name="user-69"><Value>Always</Value></Field><Field Name="user-68"><Value></Value></Field><Field Name="user-65"><Value></Value></Field><Field Name="user-64"><Value></Value></Field><Field Name="user-67"><Value></Value></Field><Field Name="user-66"><Value></Value></Field><Field Name="user-28"><Value></Value></Field><Field Name="user-29"><Value></Value></Field><Field Name="planned-closing-ver"><Value></Value></Field><Field Name="reproducible"><Value>Y</Value></Field><Field Name="user-22"/><Field Name="user-23"/><Field Name="user-20"/><Field Name="user-21"/><Field Name="user-26"><Value></Value></Field><Field Name="user-27"><Value>marga.medina_hp.com</Value></Field><Field Name="user-24"/><Field Name="user-25"/><Field Name="ver-stamp"><Value>23</Value></Field><Field Name="user-30"><Value></Value></Field><Field Name="priority"><Value></Value></Field><Field Name="user-39"><Value>4 - Low</Value></Field><Field Name="status"><Value>Closed</Value></Field><Field Name="closing-date"><Value>2018-01-08</Value></Field><Field Name="user-31"><Value></Value></Field><Field Name="user-32"><Value></Value></Field><Field Name="user-33"><Value>grupocapgemini-services.alberto.lendinez_hp.com</Value></Field><Field Name="user-34"><Value></Value></Field><Field Name="user-35"><Value></Value></Field><Field Name="user-36"><Value></Value></Field><Field Name="user-37"><Value></Value></Field><Field Name="user-38"><Value></Value></Field><Field Name="estimated-fix-time"/><Field Name="user-41"><Value></Value></Field><Field Name="user-40"><Value></Value></Field><Field Name="owner"><Value>grupocapgemini-services.carlos.barrera_hp.com</Value></Field><Field Name="actual-fix-time"><Value>0</Value></Field><Field Name="test-reference"/><Field Name="user-48"><Value></Value></Field><Field Name="user-49"/><Field Name="user-46"><Value>none</Value></Field><Field Name="user-47"><Value></Value></Field><Field Name="request-server"><Value></Value></Field><Field Name="user-44"><Value></Value></Field><Field Name="user-45"><Value></Value></Field><Field Name="user-42"><Value></Value></Field><Field Name="user-43"><Value>3</Value></Field><Field Name="user-52"><Value>3D-Tatooine</Value></Field><Field Name="id"><Value>125613</Value></Field><Field Name="user-51"><Value></Value></Field><Field Name="user-50"><Value></Value></Field><Field Name="name"><Value>[Service Center] Colour of blue points at Home map degrades with time</Value></Field><Field Name="has-linkage"><Value>N</Value></Field><Field Name="cycle-reference"><Value></Value></Field><Field Name="closing-version"><Value></Value></Field><Field Name="request-note"><Value></Value></Field><Field Name="user-57"/><Field Name="detected-in-rcyc"><Value></Value></Field><Field Name="user-58"><Value></Value></Field><Field Name="severity"><Value>4 - Low</Value></Field><Field Name="user-59"><Value></Value></Field><Field Name="attachment"><Value>Y</Value></Field><Field Name="user-53"><Value></Value></Field><Field Name="user-54"><Value>Implementation</Value></Field><Field Name="user-55"><Value></Value></Field><Field Name="user-56"><Value>4 - Low</Value></Field><Field Name="user-61"/><Field Name="detected-by"><Value>grupocapgemini-services.alberto.lendinez_hp.com</Value></Field><Field Name="user-62"><Value></Value></Field><Field Name="target-rcyc"><Value></Value></Field></Fields><RelatedEntities/></Entity></Entities>'
        second_xml = '<?xml version="1.0" encoding="UTF-8" standalone="yes"?><Entities TotalResults="995"><Entity Type="defect"><Fields><Field Name="user-template-08"><Value>01</Value></Field><Field Name="user-template-07"><Value></Value></Field><Field Name="user-template-09"><Value>01</Value></Field><Field Name="has-change"><Value></Value></Field><Field Name="user-template-02"><Value></Value></Field><Field Name="user-template-01"><Value>TEAM01</Value><Value>HP</Value></Field><Field Name="user-template-04"><Value>ALMCR78B113402</Value></Field><Field Name="user-template-03"><Value>1</Value></Field><Field Name="user-template-06"><Value>Validated</Value></Field><Field Name="user-template-05"><Value></Value></Field><Field Name="has-others-linkage"><Value>Y</Value></Field><Field Name="run-reference"/><Field Name="to-mail"><Value></Value></Field><Field Name="cycle-id"/><Field Name="user-90"><Value>PrintOS</Value></Field><Field Name="user-91"><Value></Value></Field><Field Name="user-92"><Value></Value></Field><Field Name="user-93"><Value>NPD (New products)</Value></Field><Field Name="user-94"/><Field Name="user-95"><Value></Value></Field><Field Name="user-96"><Value></Value></Field><Field Name="detected-in-rel"><Value></Value></Field><Field Name="user-103"><Value></Value></Field><Field Name="user-104"><Value></Value></Field><Field Name="user-101"><Value></Value></Field><Field Name="user-102"><Value></Value></Field><Field Name="user-100"><Value></Value></Field><Field Name="target-rel"><Value></Value></Field><Field Name="project"><Value>NPD-New Products</Value></Field><Field Name="step-reference"/><Field Name="user-87"><Value></Value></Field><Field Name="user-86"><Value></Value></Field><Field Name="user-89"><Value></Value></Field><Field Name="user-88"><Value></Value></Field><Field Name="request-type"><Value></Value></Field><Field Name="user-05"><Value>Closed</Value></Field><Field Name="user-84"><Value></Value></Field><Field Name="user-04"><Value></Value></Field><Field Name="user-85"><Value>Test: Unit</Value></Field><Field Name="user-03"><Value></Value></Field><Field Name="user-82"><Value>Thor 2 (Lx 3600)</Value></Field><Field Name="user-02"><Value></Value></Field><Field Name="user-83"><Value></Value></Field><Field Name="user-01"><Value></Value></Field><Field Name="user-80"><Value>NA</Value></Field><Field Name="user-81"><Value>ALTAMIRA_11_01_01.3/ IPS 2017.5.6.2/ PrintCare 2.2.5.1</Value></Field><Field Name="subject"/><Field Name="request-id"/><Field Name="user-09"><Value>MR9.1</Value></Field><Field Name="user-08"><Value></Value></Field><Field Name="user-07"><Value>ServiceCenter</Value></Field><Field Name="user-06"><Value></Value></Field><Field Name="user-79"/><Field Name="creation-time"><Value>2017-05-31</Value></Field><Field Name="user-78"/><Field Name="user-77"/><Field Name="user-76"/><Field Name="user-75"><Value>Test Executor</Value></Field><Field Name="user-14"><Value>2018-04-12 12:24:08</Value></Field><Field Name="detection-version"><Value></Value></Field><Field Name="user-71"><Value></Value></Field><Field Name="user-13"><Value></Value></Field><Field Name="user-72"><Value></Value></Field><Field Name="user-16"><Value>2018-05-03 08:38:03</Value></Field><Field Name="user-73"><Value></Value></Field><Field Name="user-15"><Value></Value></Field><Field Name="user-74"><Value></Value></Field><Field Name="user-10"><Value></Value></Field><Field Name="last-modified"><Value>2019-01-16 11:41:16</Value></Field><Field Name="user-12"><Value>2018-03-14 10:29:58</Value></Field><Field Name="user-11"><Value></Value></Field><Field Name="user-70"><Value></Value></Field><Field Name="user-template-16"><Value></Value></Field><Field Name="user-template-15"><Value></Value></Field><Field Name="user-template-14"><Value>2018-04-12</Value></Field><Field Name="user-template-13"/><Field Name="user-18"><Value></Value></Field><Field Name="user-template-12"><Value></Value></Field><Field Name="user-17"><Value></Value></Field><Field Name="user-template-11"><Value>Resolution Approved</Value></Field><Field Name="user-template-10"><Value></Value></Field><Field Name="user-19"><Value>2017-05-31</Value></Field><Field Name="extended-reference"><Value></Value></Field><Field Name="user-69"><Value>Always</Value></Field><Field Name="user-68"><Value></Value></Field><Field Name="user-65"><Value></Value></Field><Field Name="user-64"><Value></Value></Field><Field Name="user-67"><Value></Value></Field><Field Name="user-66"><Value></Value></Field><Field Name="user-28"><Value></Value></Field><Field Name="user-29"><Value></Value></Field><Field Name="planned-closing-ver"><Value></Value></Field><Field Name="reproducible"><Value>Y</Value></Field><Field Name="user-22"/><Field Name="user-23"/><Field Name="user-20"/><Field Name="user-21"/><Field Name="user-26"><Value></Value></Field><Field Name="user-27"><Value></Value></Field><Field Name="user-24"/><Field Name="user-25"/><Field Name="ver-stamp"><Value>58</Value></Field><Field Name="user-30"><Value></Value></Field><Field Name="priority"><Value></Value></Field><Field Name="user-39"><Value>3 - Medium</Value></Field><Field Name="status"><Value>Closed</Value></Field><Field Name="closing-date"><Value>2018-05-03</Value></Field><Field Name="user-31"><Value></Value></Field><Field Name="user-32"><Value></Value></Field><Field Name="user-33"><Value>grupocapgemini-services.netza.perez_hp.com</Value></Field><Field Name="user-34"><Value></Value></Field><Field Name="user-35"><Value></Value></Field><Field Name="user-36"><Value></Value></Field><Field Name="user-37"><Value></Value></Field><Field Name="user-38"><Value></Value></Field><Field Name="estimated-fix-time"/><Field Name="user-41"><Value></Value></Field><Field Name="user-40"><Value></Value></Field><Field Name="owner"><Value>grupocapgemini-services.silviamorcillo_hp.com</Value></Field><Field Name="actual-fix-time"><Value>0</Value></Field><Field Name="test-reference"/><Field Name="user-48"><Value></Value></Field><Field Name="user-49"/><Field Name="user-46"><Value>NA</Value></Field><Field Name="user-47"><Value></Value></Field><Field Name="request-server"><Value></Value></Field><Field Name="user-44"><Value></Value></Field><Field Name="user-45"><Value></Value></Field><Field Name="user-42"><Value>None</Value></Field><Field Name="user-43"><Value>6</Value></Field><Field Name="user-52"><Value>LX3600</Value></Field><Field Name="id"><Value>113402</Value></Field><Field Name="user-51"><Value></Value></Field><Field Name="user-50"><Value></Value></Field><Field Name="name"><Value>Printer maintenance status is not the same in Sonar and PrintCare (and Service Center)</Value></Field><Field Name="has-linkage"><Value>N</Value></Field><Field Name="cycle-reference"><Value></Value></Field><Field Name="closing-version"><Value></Value></Field><Field Name="request-note"><Value></Value></Field><Field Name="user-57"><Value>None</Value></Field><Field Name="detected-in-rcyc"><Value></Value></Field><Field Name="user-58"><Value></Value></Field><Field Name="severity"><Value>4 - Low</Value></Field><Field Name="user-59"><Value></Value></Field><Field Name="attachment"><Value>Y</Value></Field><Field Name="user-53"><Value></Value></Field><Field Name="user-54"><Value>Implementation</Value></Field><Field Name="user-55"><Value></Value></Field><Field Name="user-56"><Value>3 - Medium</Value></Field><Field Name="user-61"/><Field Name="detected-by"><Value>grupocapgemini-services.netza.perez_hp.com</Value></Field><Field Name="user-62"><Value></Value></Field><Field Name="target-rcyc"><Value></Value></Field></Fields><RelatedEntities/></Entity><Entity Type="defect"><Fields><Field Name="user-template-08"><Value>01</Value></Field><Field Name="user-template-07"><Value></Value></Field><Field Name="user-template-09"><Value>01</Value></Field><Field Name="has-change"><Value></Value></Field><Field Name="user-template-02"><Value></Value></Field><Field Name="user-template-01"><Value>TEAM01</Value><Value>HP</Value></Field><Field Name="user-template-04"><Value>ALMCR78B123206</Value></Field><Field Name="user-template-03"><Value>0</Value></Field><Field Name="user-template-06"><Value>Validated</Value></Field><Field Name="user-template-05"><Value></Value></Field><Field Name="has-others-linkage"><Value>N</Value></Field><Field Name="run-reference"/><Field Name="to-mail"><Value></Value></Field><Field Name="cycle-id"/><Field Name="user-90"><Value>PrintOS</Value></Field><Field Name="user-91"><Value></Value></Field><Field Name="user-92"><Value></Value></Field><Field Name="user-93"><Value></Value></Field><Field Name="user-94"/><Field Name="user-95"><Value></Value></Field><Field Name="user-96"><Value></Value></Field><Field Name="detected-in-rel"><Value></Value></Field><Field Name="user-103"><Value></Value></Field><Field Name="user-104"><Value></Value></Field><Field Name="user-101"><Value></Value></Field><Field Name="user-102"><Value></Value></Field><Field Name="user-100"><Value></Value></Field><Field Name="target-rel"><Value></Value></Field><Field Name="project"><Value>NPD-New Products</Value></Field><Field Name="step-reference"/><Field Name="user-87"><Value></Value></Field><Field Name="user-86"><Value></Value></Field><Field Name="user-89"><Value></Value></Field><Field Name="user-88"><Value></Value></Field><Field Name="request-type"><Value></Value></Field><Field Name="user-05"><Value>Closed</Value></Field><Field Name="user-84"><Value></Value></Field><Field Name="user-04"><Value></Value></Field><Field Name="user-85"><Value>Test: Exploratory</Value></Field><Field Name="user-03"><Value></Value></Field><Field Name="user-82"><Value>Z600 Workstation, windows 10x64</Value></Field><Field Name="user-02"><Value></Value></Field><Field Name="user-83"><Value></Value></Field><Field Name="user-01"><Value></Value></Field><Field Name="user-80"><Value>NA</Value></Field><Field Name="user-81"><Value>Mozilla Firefox</Value></Field><Field Name="subject"/><Field Name="request-id"/><Field Name="user-09"><Value></Value></Field><Field Name="user-08"><Value></Value></Field><Field Name="user-07"><Value>PrintOS</Value></Field><Field Name="user-06"><Value></Value></Field><Field Name="user-79"/><Field Name="creation-time"><Value>2017-10-25</Value></Field><Field Name="user-78"/><Field Name="user-77"/><Field Name="user-76"/><Field Name="user-75"><Value>Test Executor</Value></Field><Field Name="user-14"><Value>2018-01-12 08:09:40</Value></Field><Field Name="detection-version"><Value></Value></Field><Field Name="user-71"><Value></Value></Field><Field Name="user-13"><Value></Value></Field><Field Name="user-72"><Value></Value></Field><Field Name="user-16"><Value>2018-01-12 08:23:38</Value></Field><Field Name="user-73"><Value></Value></Field><Field Name="user-15"><Value></Value></Field><Field Name="user-74"><Value></Value></Field><Field Name="user-10"><Value></Value></Field><Field Name="last-modified"><Value>2018-11-16 06:53:30</Value></Field><Field Name="user-12"><Value>2017-11-06 16:42:06</Value></Field><Field Name="user-11"><Value></Value></Field><Field Name="user-70"><Value></Value></Field><Field Name="user-template-16"><Value></Value></Field><Field Name="user-template-15"><Value></Value></Field><Field Name="user-template-14"><Value>2018-01-12</Value></Field><Field Name="user-template-13"/><Field Name="user-18"><Value></Value></Field><Field Name="user-template-12"><Value></Value></Field><Field Name="user-17"><Value></Value></Field><Field Name="user-template-11"><Value>Resolution Approved</Value></Field><Field Name="user-template-10"><Value></Value></Field><Field Name="user-19"><Value>2017-10-25</Value></Field><Field Name="extended-reference"><Value></Value></Field><Field Name="user-69"><Value>Always</Value></Field><Field Name="user-68"><Value></Value></Field><Field Name="user-65"><Value></Value></Field><Field Name="user-64"><Value></Value></Field><Field Name="user-67"><Value></Value></Field><Field Name="user-66"><Value></Value></Field><Field Name="user-28"><Value></Value></Field><Field Name="user-29"><Value></Value></Field><Field Name="planned-closing-ver"><Value></Value></Field><Field Name="reproducible"><Value>Y</Value></Field><Field Name="user-22"/><Field Name="user-23"/><Field Name="user-20"/><Field Name="user-21"/><Field Name="user-26"><Value></Value></Field><Field Name="user-27"><Value>marga.medina_hp.com</Value></Field><Field Name="user-24"/><Field Name="user-25"/><Field Name="ver-stamp"><Value>18</Value></Field><Field Name="user-30"><Value></Value></Field><Field Name="priority"><Value></Value></Field><Field Name="user-39"><Value>3 - Medium</Value></Field><Field Name="status"><Value>Closed</Value></Field><Field Name="closing-date"><Value>2018-01-12</Value></Field><Field Name="user-31"><Value></Value></Field><Field Name="user-32"><Value></Value></Field><Field Name="user-33"><Value></Value></Field><Field Name="user-34"><Value></Value></Field><Field Name="user-35"><Value></Value></Field><Field Name="user-36"><Value></Value></Field><Field Name="user-37"><Value></Value></Field><Field Name="user-38"><Value></Value></Field><Field Name="estimated-fix-time"/><Field Name="user-41"><Value></Value></Field><Field Name="user-40"><Value></Value></Field><Field Name="owner"><Value>grupocapgemini-services.carlos.barrera_hp.com</Value></Field><Field Name="actual-fix-time"><Value>0</Value></Field><Field Name="test-reference"/><Field Name="user-48"><Value></Value></Field><Field Name="user-49"/><Field Name="user-46"><Value>NA</Value></Field><Field Name="user-47"><Value></Value></Field><Field Name="request-server"><Value></Value></Field><Field Name="user-44"><Value></Value></Field><Field Name="user-45"><Value></Value></Field><Field Name="user-42"><Value></Value></Field><Field Name="user-43"><Value>6</Value></Field><Field Name="user-52"><Value>3D-Tatooine</Value></Field><Field Name="id"><Value>123206</Value></Field><Field Name="user-51"><Value></Value></Field><Field Name="user-50"><Value></Value></Field><Field Name="name"><Value>[PrintOS] Save button at &quot;Edit selected device&quot; is disabled</Value></Field><Field Name="has-linkage"><Value>N</Value></Field><Field Name="cycle-reference"><Value></Value></Field><Field Name="closing-version"><Value></Value></Field><Field Name="request-note"><Value></Value></Field><Field Name="user-57"/><Field Name="detected-in-rcyc"><Value></Value></Field><Field Name="user-58"><Value></Value></Field><Field Name="severity"><Value>3 - Medium</Value></Field><Field Name="user-59"><Value></Value></Field><Field Name="attachment"><Value>Y</Value></Field><Field Name="user-53"><Value></Value></Field><Field Name="user-54"><Value>Implementation</Value></Field><Field Name="user-55"><Value></Value></Field><Field Name="user-56"><Value>3 - Medium</Value></Field><Field Name="user-61"/><Field Name="detected-by"><Value>grupocapgemini-services.alberto.lendinez_hp.com</Value></Field><Field Name="user-62"><Value></Value></Field><Field Name="target-rcyc"><Value></Value></Field></Fields><RelatedEntities/></Entity></Entities>'
        result = parse_xml.merge(original_xml=original_xml, second_xml=second_xml)

        root = etree.fromstring(result.encode('utf-8'))

        # root.xpath("Entity[1]/Fields/Field[1]")[0].get("Name") equivalent to (but prefered):
        # root.xpath("Entity[1]/Fields/Field[1]/@Name")[0]

        self.assertEqual("defect", root.xpath("Entity[1]")[0].get("Type"))
        self.assertEqual("user-template-08", root.xpath("Entity[1]/Fields/Field[1]")[0].get("Name"))
        self.assertEqual("ipalomar", root.xpath("Entity[1]/Fields/Field[1]/Value")[0].text)
        # when querying for an XPath that does not exists, it returns None type, NOT empty string
        self.assertEqual("user-template-07", root.xpath("Entity[1]/Fields/Field[2]")[0].get("Name"))
        self.assertEqual(None, root.xpath("Entity[1]/Fields/Field[2]/Value")[0].text)
        self.assertEqual("user-template-09", root.xpath("Entity[1]/Fields/Field[3]")[0].get("Name"))
        self.assertEqual("arturo_domingo", root.xpath("Entity[1]/Fields/Field[3]/Value")[0].text)
        self.assertEqual("has-change", root.xpath("Entity[1]/Fields/Field[4]")[0].get("Name"))
        self.assertEqual(None, root.xpath("Entity[1]/Fields/Field[4]/Value")[0].text)
        self.assertEqual("user-template-02", root.xpath("Entity[1]/Fields/Field[5]")[0].get("Name"))
        self.assertEqual(None, root.xpath("Entity[1]/Fields/Field[5]/Value")[0].text)
        self.assertEqual("priority", root.xpath("Entity[1]/Fields/Field[6]")[0].get("Name"))
        self.assertEqual(None, root.xpath("Entity[1]/Fields/Field[6]/Value")[0].text)
        self.assertEqual("user-39", root.xpath("Entity[1]/Fields/Field[7]")[0].get("Name"))
        self.assertEqual("3 - Medium", root.xpath("Entity[1]/Fields/Field[7]/Value")[0].text)
        self.assertEqual("status", root.xpath("Entity[1]/Fields/Field[8]")[0].get("Name"))
        self.assertEqual("Closed", root.xpath("Entity[1]/Fields/Field[8]/Value")[0].text)
        self.assertEqual("closing-date", root.xpath("Entity[1]/Fields/Field[9]")[0].get("Name"))
        self.assertEqual("2018-10-01", root.xpath("Entity[1]/Fields/Field[9]/Value")[0].text)
        self.assertEqual("name", root.xpath("/Entities/Entity[1]/Fields/Field[49]")[0].get("Name"))
        self.assertEqual("Print Care Maintenance alerts (PMK alerts) are not displaying the same information on Printcare and Sonar UI Web", root.xpath("/Entities/Entity[1]/Fields/Field[49]/Value")[0].text)

        self.assertEqual("defect", root.xpath("Entity[2]")[0].get("Type"))
        self.assertEqual("user-template-01", root.xpath("/Entities/Entity[2]/Fields/Field[6]")[0].get("Name"))
        self.assertEqual("TEAM01", root.xpath("/Entities/Entity[2]/Fields/Field[6]/Value")[0].text)
        self.assertEqual("HP", root.xpath("/Entities/Entity[2]/Fields/Field[6]/Value")[1].text)
        self.assertEqual("user-template-04", root.xpath("/Entities/Entity[2]/Fields/Field[7]")[0].get("Name"))
        self.assertEqual("ALMCR78B125613", root.xpath("/Entities/Entity[2]/Fields/Field[7]/Value")[0].text)
        self.assertEqual("detected-in-rel", root.xpath("/Entities/Entity[2]/Fields/Field[22]")[0].get("Name"))
        self.assertEqual(None, root.xpath("/Entities/Entity[2]/Fields/Field[22]/Value")[0].text)
        self.assertEqual("project", root.xpath("/Entities/Entity[2]/Fields/Field[29]")[0].get("Name"))
        self.assertEqual("NPD-New Products", root.xpath("/Entities/Entity[2]/Fields/Field[29]/Value")[0].text)
        self.assertEqual("user-14", root.xpath("/Entities/Entity[2]/Fields/Field[59]")[0].get("Name"))
        self.assertEqual("2018-01-02 07:37:24", root.xpath("/Entities/Entity[2]/Fields/Field[59]/Value")[0].text)

        self.assertEqual("defect", root.xpath("Entity[3]")[0].get("Type"))
        self.assertEqual("user-93", root.xpath("/Entities/Entity[3]/Fields/Field[18]")[0].get("Name"))
        self.assertEqual("NPD (New products)", root.xpath("/Entities/Entity[3]/Fields/Field[18]/Value")[0].text)
        self.assertEqual("user-81", root.xpath("/Entities/Entity[3]/Fields/Field[46]")[0].get("Name"))
        self.assertEqual("ALTAMIRA_11_01_01.3/ IPS 2017.5.6.2/ PrintCare 2.2.5.1", root.xpath("/Entities/Entity[3]/Fields/Field[46]/Value")[0].text)
        self.assertEqual("detected-by", root.xpath("/Entities/Entity[3]/Fields/Field[151]")[0].get("Name"))
        self.assertEqual("grupocapgemini-services.netza.perez_hp.com", root.xpath("/Entities/Entity[3]/Fields/Field[151]/Value")[0].text)

        self.assertEqual("defect", root.xpath("Entity[4]")[0].get("Type"))
        self.assertEqual("user-82", root.xpath("/Entities/Entity[4]/Fields/Field[41]")[0].get("Name"))
        self.assertEqual("Z600 Workstation, windows 10x64", root.xpath("/Entities/Entity[4]/Fields/Field[41]/Value")[0].text)
        self.assertEqual("detected-by", root.xpath("/Entities/Entity[4]/Fields/Field[151]")[0].get("Name"))
        self.assertEqual("grupocapgemini-services.alberto.lendinez_hp.com", root.xpath("/Entities/Entity[4]/Fields/Field[151]/Value")[0].text)

    def test_get_entities(self):
        xml = '<?xml version="1.0" encoding="UTF-8" standalone="yes"?><Entities TotalResults="995"><Entity Type="defect"><Fields><Field Name="user-template-08"><Value>ipalomar</Value></Field><Field Name="user-template-07"><Value></Value></Field><Field Name="user-template-09"><Value>arturo_domingo</Value></Field><Field Name="name"><Value>Print Care Maintenance alerts (PMK alerts) are not displaying the same information on Printcare and Sonar UI Web</Value></Field></Fields><RelatedEntities/></Entity><Entity Type="defect"><Fields><Field Name="user-102"><Value></Value></Field><Field Name="user-100"><Value></Value></Field></Fields><RelatedEntities/></Entity></Entities>'
        self.assertEqual("995", parse_xml.get_entities_total_results(xml))

    def test_get_entities2(self):
        xml = '<?xml version="1.0" encoding="UTF-8" standalone="yes"?><Entities TotalResults="1066"><Entity Type="defect"><Fields><Field Name="user-template-08"><Value>ipalomar</Value></Field></Fields><RelatedEntities/></Entity></Entities>'
        self.assertEqual("1066", parse_xml.get_entities_total_results(xml))


if __name__ == '__main__':
    unittest.main()
